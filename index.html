<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      #view{
        border: 10px solid #000;
        overflow: auto;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <div id="view">
      
    </div>
    room:<input type="text" name="" size="10" id="room" id=""><br>
    message:<input type="text" name="" size="10" id="message" id=""><br>
    <button id="join">Join Room</button>
    <button id="send">Message to room</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.1/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      $(function () {
        var socket = io();
        // Copy mouse position
        $(document).bind('mousemove',function(e){ 
          var mdata = {};
          mdata.mouse = {};
          mdata.mouse.x = e.pageX;
          mdata.mouse.y = e.pageY;
          mdata.room = $('#room').val() || '0';

          socket.emit('mousecursor', mdata); 
        }); 

        $('#send').on('click', function () {
          socket.emit('roomMessage', {room: $('#room').val(), message: $('#message').val() }); 
        });
        $('#join').on('click', function () {
          socket.emit('initRoom', {room: $('#room').val() }); 
          socket.emit('room', $('#room').val());
        });

        // init page, copy VIEW
        socket.on('connected',function(data){
          console.log(data);
          alert('connected');
          // if(data.room==$('#room').val()){
            $v = $('#view');
            $v.width(data.width);
            $v.height(data.height);
            $v.html($.parseHTML(data.html));
            $('head').append($.parseHTML(data.head));
          // }
        })

        // Copy form input to client
        $('body').on('keyup','input', function () {
          var data = {};
          data.inputs = {};
          data.room = $('#room').val() || '0';
          $('input').each(function(index,el){
            data.inputs[$(el).data('ws-index')] = $(el).val();
          });
          socket.emit('inputchange', data); 
        });

        // socket.on('room', function(room) {
        //     socket.join(room);
        //     console.log('joining',room);
        // });
      });
    </script>
  </body>
</html>
